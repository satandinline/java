# Java版本系统安装说明

**版本：** 1.0  
**更新日期：** 2026年1月9日

本文档详细说明Java版本项目的系统安装步骤和配置要求。

## 目录

- [系统要求](#系统要求)
- [环境准备](#环境准备)
- [数据库配置](#数据库配置)
- [项目安装](#项目安装)
- [配置说明](#配置说明)
- [启动项目](#启动项目)
- [验证安装](#验证安装)
- [常见问题](#常见问题)

## 系统要求

### 硬件要求

- **CPU**: 2核心或以上
- **内存**: 4GB RAM或以上（推荐8GB）
- **硬盘**: 至少10GB可用空间
- **网络**: 需要互联网连接（用于下载依赖）

### 软件要求

#### 必需软件

1. **JDK 21或更高版本**
   - 下载地址：https://www.oracle.com/java/technologies/downloads/
   - 或使用OpenJDK：https://adoptium.net/

2. **Maven 3.6或更高版本**
   - 下载地址：https://maven.apache.org/download.cgi

3. **MySQL 5.7或更高版本（推荐MySQL 8.0+）**
   - 下载地址：https://dev.mysql.com/downloads/mysql/

4. **Node.js ^20.19.0 或 >=22.12.0**
   - 下载地址：https://nodejs.org/

5. **npm**（通常随Node.js一起安装）

#### 可选软件

- **Python 3.7+**（如使用AIGC功能）
- **Git**（用于版本控制）

## 环境准备

### 1. 安装JDK

#### Windows

1. 下载JDK 21安装包
2. 运行安装程序，按提示完成安装
3. 配置环境变量：
   - 新建系统变量 `JAVA_HOME`，值为JDK安装路径（如：`C:\Program Files\Java\jdk-21`）
   - 在系统变量 `Path` 中添加：`%JAVA_HOME%\bin`
4. 验证安装：
   ```bash
   java -version
   javac -version
   ```

#### Linux

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install openjdk-21-jdk

# CentOS/RHEL
sudo yum install java-21-openjdk-devel

# 验证安装
java -version
javac -version
```

#### macOS

```bash
# 使用Homebrew
brew install openjdk@21

# 验证安装
java -version
javac -version
```

### 2. 安装Maven

#### Windows

1. 下载Maven二进制包（apache-maven-3.x.x-bin.zip）
2. 解压到指定目录（如：`C:\Program Files\Apache\maven`）
3. 配置环境变量：
   - 新建系统变量 `MAVEN_HOME`，值为Maven解压路径
   - 在系统变量 `Path` 中添加：`%MAVEN_HOME%\bin`
4. 验证安装：
   ```bash
   mvn -version
   ```

#### Linux/macOS

```bash
# 下载并解压
wget https://dlcdn.apache.org/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz
tar -xzf apache-maven-3.9.6-bin.tar.gz
sudo mv apache-maven-3.9.6 /opt/maven

# 配置环境变量（添加到 ~/.bashrc 或 ~/.zshrc）
export MAVEN_HOME=/opt/maven
export PATH=$PATH:$MAVEN_HOME/bin

# 验证安装
mvn -version
```

### 3. 安装MySQL

#### Windows

1. 下载MySQL安装程序
2. 运行安装程序，选择"Developer Default"或"Server only"
3. 设置root用户密码
4. 完成安装并启动MySQL服务

#### Linux

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server
sudo systemctl start mysql
sudo systemctl enable mysql

# CentOS/RHEL
sudo yum install mysql-server
sudo systemctl start mysqld
sudo systemctl enable mysqld
```

#### macOS

```bash
# 使用Homebrew
brew install mysql
brew services start mysql
```

### 4. 安装Node.js和npm

#### Windows

1. 下载Node.js安装程序（LTS版本）
2. 运行安装程序，按提示完成安装
3. 验证安装：
   ```bash
   node -v
   npm -v
   ```

#### Linux

```bash
# 使用NodeSource仓库（推荐）
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# 验证安装
node -v
npm -v
```

#### macOS

```bash
# 使用Homebrew
brew install node

# 验证安装
node -v
npm -v
```

## 数据库配置

### 1. 创建数据库

登录MySQL并创建数据库：

```sql
CREATE DATABASE java_project CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. 初始化数据库表结构

```bash
cd backend-java/database_files
python run_init_schema.py
```

或者手动执行SQL脚本：

```bash
mysql -u root -p java_project < database_files/init_schema.sql
```

### 3. 创建数据库用户（可选）

```sql
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON java_project.* TO 'app_user'@'localhost';
FLUSH PRIVILEGES;
```

## 项目安装

### 1. 获取项目代码

如果使用Git：

```bash
git clone <repository-url>
cd Java-project/backend-java
```

或直接解压项目压缩包到指定目录。

### 2. 配置数据库连接

编辑 `src/main/resources/application.yml`：

```yaml
spring:
  datasource:
    url: jdbc:mysql://127.0.0.1:3306/java_project?useUnicode=true&useSSL=false&serverTimezone=Asia/Shanghai&connectionCollation=utf8mb4_unicode_ci
    username: root
    password: your_password
```

或使用环境变量（推荐）：

在项目根目录创建 `.env` 文件：

```env
MYSQL_HOST=127.0.0.1
MYSQL_PORT=3306
MYSQL_DB=java_project
MYSQL_USER=root
MYSQL_PASSWORD=your_password
```

### 3. 安装Java后端依赖

```bash
cd backend-java
mvn clean install
```

首次运行会下载所有依赖，可能需要几分钟时间。

### 4. 安装前端依赖

```bash
cd backend-java/FrontEnd
npm install
```

### 5. 安装Python依赖（可选，如使用AIGC功能）

```bash
cd backend-python
pip install -r requirements.txt
```

## 配置说明

### 应用配置

主要配置文件：`src/main/resources/application.yml`

- **数据库配置**：已在上述步骤中配置
- **服务器端口**：默认7210，可在配置文件中修改
- **文件上传限制**：默认最大50MB
- **日志级别**：默认INFO

### 前端配置

主要配置文件：`FrontEnd/vite.config.js`

- **前端端口**：默认5193
- **后端代理**：默认代理到 `http://localhost:7210`

### AIGC服务配置（可选）

如需使用AIGC功能，需要：

1. 在项目根目录的 `.env` 文件中配置API密钥：
   ```env
   OPENAI_API_KEY=your_openai_key
   DASHSCOPE_API_KEY=your_dashscope_key
   VOLC_SEEDREAM_API_KEY=your_volc_key
   GEMINI_API_KEY=your_gemini_key
   ```

2. 确保Python AIGC服务运行在 `http://localhost:7200`

## 启动项目

### 方式一：使用启动脚本（推荐）

#### Windows

```bash
# 批处理脚本
启动项目.bat

# PowerShell脚本
.\启动项目.ps1
```

#### Linux/macOS

```bash
chmod +x start.sh
./start.sh
```

### 方式二：使用Maven

```bash
cd backend-java
mvn spring-boot:run
```

前端需要单独启动：

```bash
cd FrontEnd
npm run dev
```

### 方式三：使用StartupManager（自动启动前后端）

```bash
cd backend-java
mvn compile exec:java -Dexec.mainClass=com.app.StartupManager
```

### 方式四：打包后运行

```bash
# 打包
mvn clean package

# 运行jar包
java -jar target/cultural-resources-backend-1.0.0.jar
```

## 验证安装

### 1. 检查后端服务

访问：http://localhost:7210/api/health

应该返回：
```json
{
  "status": "UP"
}
```

### 2. 检查前端服务

访问：http://localhost:5193

应该看到前端页面正常加载。

### 3. 检查数据库连接

查看后端启动日志，确认数据库连接成功。

### 4. 测试API接口

使用Postman或curl测试API：

```bash
# 健康检查
curl http://localhost:7210/api/health

# 获取首页资源
curl http://localhost:7210/api/home/resources?page=1&page_size=8
```

## 常见问题

### 1. Maven下载依赖失败

**问题**：Maven下载依赖时超时或失败

**解决方案**：
- 检查网络连接
- 配置Maven镜像（编辑 `~/.m2/settings.xml`）：
  ```xml
  <mirrors>
    <mirror>
      <id>aliyun</id>
      <mirrorOf>central</mirrorOf>
      <url>https://maven.aliyun.com/repository/public</url>
    </mirror>
  </mirrors>
  ```

### 2. 数据库连接失败

**问题**：启动时提示数据库连接失败

**解决方案**：
- 确认MySQL服务已启动
- 检查数据库配置是否正确
- 确认数据库 `java_project` 已创建
- 检查防火墙设置

### 3. 端口被占用

**问题**：提示端口7210或5193已被占用

**解决方案**：
- 关闭占用端口的程序
- 或修改配置文件中的端口号

### 4. 前端依赖安装失败

**问题**：npm install 失败

**解决方案**：
- 使用国内镜像：`npm config set registry https://registry.npmmirror.com`
- 清除缓存：`npm cache clean --force`
- 删除 `node_modules` 和 `package-lock.json` 后重新安装

### 5. Java版本不匹配

**问题**：编译时提示Java版本错误

**解决方案**：
- 确认JDK版本为21或更高
- 检查 `JAVA_HOME` 环境变量
- 使用 `java -version` 确认当前Java版本

### 6. 字符编码问题

**问题**：中文显示乱码

**解决方案**：
- 确认数据库字符集为 `utf8mb4`
- 确认 `application.yml` 中配置了正确的字符编码
- 确认IDE和终端编码为UTF-8

## 下一步

安装完成后，请参考：

- [用户使用手册.md](./用户使用手册.md) - 了解如何使用系统
- [技术实现手册.md](./技术实现手册.md) - 了解技术实现细节
- [README.md](./README.md) - 查看项目概述

## 技术支持

如遇到安装问题，请：

1. 检查本文档的"常见问题"部分
2. 查看项目日志文件
3. 联系技术支持团队
